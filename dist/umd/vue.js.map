{"version":3,"file":"vue.js","sources":["../../src/util/index.js","../../src/observe/array.js","../../src/observe/index.js","../../src/state.js","../../src/compile/index.js","../../src/init.js","../../src/index.js"],"sourcesContent":["export function isObject(data) {\r\n  return typeof data === \"object\" && data !== null;\r\n}\r\nexport function def(object, key, value) {\r\n  Object.defineProperty(object, key, {\r\n    enumerable: false, //不可枚举\r\n    configurable: false, //不可改写\r\n    value,\r\n  });\r\n}\r\n","// 只需要重写会改变原数组的方法,7个,\r\n\r\nlet oldArrayMethods = Array.prototype;\r\n\r\nexport let arrayMethods = Object.create(oldArrayMethods); //原型链  新类 的__proto__ 指向 oldArrayMethods\r\n\r\nconst methods = [\"pop\", \"push\", \"unshift\", \"shift\", \"reverse\", \"sort\", \"splice\"];\r\n\r\nmethods.forEach((method) => {\r\n  arrayMethods[method] = function (...args) {\r\n    // AOP切片编程\r\n    const result = oldArrayMethods[method].apply(this, args);\r\n    // 如果插入的参数,还是一个对象\r\n    let inserted;\r\n    switch (method) {\r\n      case \"push\":\r\n      case \"unshift\":\r\n        inserted = args;\r\n        break;\r\n      case \"splice\": // splice 中间有删除  新增  替换 只需要观测第三个参数\r\n        inserted = args.slice(2);\r\n\r\n      default:\r\n        break;\r\n    }\r\n    let ob = this.__ob__;\r\n    if (inserted) {\r\n      ob.observeArray(inserted);\r\n    }\r\n    return result;\r\n  };\r\n});\r\n","import { isObject, def } from \"../util/index\";\r\nimport { arrayMethods } from \"./array.js\";\r\n\r\nclass Observe {\r\n  constructor(value) {\r\n    // 数据越复杂 层次越深 越费性能,vue2使用递归来给数据定义get 和set\r\n    if (Array.isArray(value)) {\r\n      // 如果是数组的话,并不应去检测数组的索引,浪费性能\r\n      // 但是监控数组的 push pop shift unshift\r\n      value.__ob__ = this; // 方便其他模块调用实例方法\r\n      def(value, \"__ob__\", this);\r\n      value.__proto__ = arrayMethods;\r\n      this.observeArray(value); // 对数组内容拦截\r\n    } else {\r\n      this.walk(value);\r\n    }\r\n  }\r\n  walk(data) {\r\n    let keys = Object.keys(data);\r\n    keys.forEach((key) => {\r\n      defineReactive(data, key, data[key]);\r\n    });\r\n  }\r\n  observeArray(value) {\r\n    for (let i = 0; i < value.length; i++) {\r\n      observe(value[i]);\r\n    }\r\n  }\r\n}\r\nfunction defineReactive(data, key, value) {\r\n  //响应式核心\r\n  observe(value);\r\n  Object.defineProperty(data, key, {\r\n    set(newValue) {\r\n      if (newValue === value) return;\r\n      observe(newValue); // 更换数据后,继续添加监听\r\n      value = newValue;\r\n    },\r\n    get() {\r\n      return value;\r\n    },\r\n  });\r\n}\r\n\r\nexport function observe(data) {\r\n  if (!isObject(data)) {\r\n    return;\r\n  }\r\n  return new Observe(data);\r\n}\r\n","import { observe } from \"./observe/index.js\";\r\nexport function initState(vm) {\r\n  const opts = vm.$options;\r\n  // vue 的数据来源 属性 方法 数据 计算属性 watch\r\n  if (opts.props) {\r\n    initProps(vm);\r\n  }\r\n  if (opts.methods) {\r\n    initMethod(vm);\r\n  }\r\n  if (opts.data) {\r\n    initData(vm);\r\n  }\r\n  if (opts.computed) {\r\n    initComputed(vm);\r\n  }\r\n  if (opts.watch) {\r\n    initWatch(vm);\r\n  }\r\n}\r\nfunction initProps() {}\r\nfunction initMethod() {}\r\nfunction initData(vm) {\r\n  //初始化数据\r\n  let data = vm.$options.data;\r\n  data = typeof data === \"function\" ? data.call(vm) : data;\r\n  vm._data = data;\r\n  //对象劫持 用户改变了数据 我希望可以得到通知 => 刷新页面\r\n  // MVVM 数据变化 驱动 视图变化\r\n  // Object.definedProperty(); 给属性增加 set 和 get 方法\r\n  observe(data); //响应式原理\r\n}\r\nfunction initComputed() {}\r\nfunction initWatch() {}\r\n","const ncname = `[a-zA-Z_][\\\\-\\\\.0-9_a-zA-Z]*`;\r\nconst qnameCapture = `((?:${ncname}\\\\:)?${ncname})`;\r\nconst startTagOpen = new RegExp(`^<${qnameCapture}`); // 标签开头的正则 捕获的内容是标签名\r\nconst endTag = new RegExp(`^<\\\\/${qnameCapture}[^>]*>`); // 匹配标签结尾的 </div>\r\nconst attribute = /^\\s*([^\\s\"'<>\\/=]+)(?:\\s*(=)\\s*(?:\"([^\"]*)\"+|'([^']*)'+|([^\\s\"'=<>`]+)))?/; // 匹配属性的\r\nconst startTagClose = /^\\s*(\\/?)>/; // 匹配标签结束的 >\r\nconst defaultTagRE = /\\{\\{((?:.|\\r?\\n)+?)\\}\\}/g;\r\nfunction start(tagName, attrs) {\r\n\tconsole.log(tagName, attrs);\r\n}\r\nfunction end(tagName) {\r\n\tconsole.log(tagName);\r\n}\r\nfunction chars(text) {\r\n\tconsole.log(text);\r\n}\r\nfunction parseHTML(html) {\r\n\twhile (html) {\r\n\t\tlet textEnd = html.indexOf(\"<\");\r\n\t\tif (textEnd == 0) {\r\n\t\t\tconst startTagMatch = parseStartTag();\r\n\t\t\tif (startTagMatch) {\r\n\t\t\t\tstart(startTagMatch.tagName, startTagMatch.attrs);\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tconst endTagMatch = html.match(endTag);\r\n\t\t\tif (endTagMatch) {\r\n\t\t\t\tadvance(endTagMatch[0].length);\r\n\t\t\t\tend(endTagMatch[1]);\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t}\r\n\t\tlet text;\r\n\t\tif (textEnd >= 0) {\r\n\t\t\ttext = html.substring(0, textEnd);\r\n\t\t}\r\n\t\tif (text) {\r\n\t\t\tadvance(text.length);\r\n\t\t\tchars(text);\r\n\t\t}\r\n\t}\r\n\tfunction advance(n) {\r\n\t\thtml = html.substring(n);\r\n\t}\r\n\tfunction parseStartTag() {\r\n\t\tconst start = html.match(startTagOpen);\r\n\t\tif (start) {\r\n\t\t\tconst match = {\r\n\t\t\t\ttagName: start[1],\r\n\t\t\t\tattrs: [],\r\n\t\t\t};\r\n\t\t\tadvance(start[0].length);\r\n\t\t\tlet attr, end;\r\n\t\t\twhile (!(end = html.match(startTagClose)) && (attr = html.match(attribute))) {\r\n\t\t\t\tadvance(attr[0].length);\r\n\t\t\t\tmatch.attrs.push({ name: attr[1], value: attr[3] });\r\n\t\t\t}\r\n\t\t\tif (end) {\r\n\t\t\t\tadvance(end[0].length);\r\n\t\t\t\treturn match;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\nexport function compileToFunctions(template) {\r\n\tparseHTML(template);\r\n\treturn function () {};\r\n}\r\n","import { initState } from \"./state.js\";\r\nimport { compileToFunctions } from \"./compile/index.js\";\r\nexport function initMixin(Vue) {\r\n\t//初始化流程\r\n\tVue.prototype._init = function (options) {\r\n\t\t//数据的劫持\r\n\t\tconst vm = this; // vue 中使用 this.$options 指代的就是用户传递的属性\r\n\t\tvm.$options = options;\r\n\t\tinitState(vm);\r\n\r\n\t\t// 如果用户传入了 el ,需要将页面渲染出来\r\n\t\tif (vm.$options.el) {\r\n\t\t\tvm.$mount(vm.$options.el);\r\n\t\t}\r\n\t};\r\n\tVue.prototype.$mount = function (el) {\r\n\t\tlet vm = this;\r\n\t\tlet options = vm.$options;\r\n\t\tel = document.querySelector(el);\r\n\t\t//默认先会查找有没有render函数 ,没有render 采用template template也没有就用el中的内容\r\n\r\n\t\tif (!options.render) {\r\n\t\t\t//对模板进行编译\r\n\t\t\tlet template = options.template;\r\n\t\t\tif (!template && el) {\r\n\t\t\t\ttemplate = el.outerHTML;\r\n\t\t\t}\r\n\t\t\tconst render = compileToFunctions(template);\r\n\t\t\toptions.render = render;\r\n\t\t\t//需要将template 转换成render 方法;\r\n\t\t}\r\n\t\toptions.render();\r\n\t};\r\n}\r\n","// Vue 声明文件\r\nimport { initMixin } from \"./init.js\";\r\nfunction Vue(option) {\r\n  this._init(option);\r\n}\r\ninitMixin(Vue);\r\n\r\nexport default Vue;\r\n"],"names":["isObject","data","def","object","key","value","Object","defineProperty","enumerable","configurable","oldArrayMethods","Array","prototype","arrayMethods","create","methods","forEach","method","args","result","apply","inserted","slice","ob","__ob__","observeArray","Observe","isArray","__proto__","walk","keys","defineReactive","i","length","observe","set","newValue","get","initState","vm","opts","$options","props","initData","computed","watch","call","_data","ncname","qnameCapture","startTagOpen","RegExp","endTag","attribute","startTagClose","start","tagName","attrs","console","log","end","chars","text","parseHTML","html","textEnd","indexOf","startTagMatch","parseStartTag","endTagMatch","match","advance","substring","n","attr","push","name","compileToFunctions","template","initMixin","Vue","_init","options","el","$mount","document","querySelector","render","outerHTML","option"],"mappings":"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"}