{"version":3,"file":"vue.js","sources":["../../src/util/index.js","../../src/observe/array.js","../../src/observe/index.js","../../src/state.js","../../src/init.js","../../src/index.js"],"sourcesContent":["export function isObject(data) {\r\n  return typeof data === \"object\" && data !== null;\r\n}\r\nexport function def(object, key, value) {\r\n  Object.defineProperty(object, key, {\r\n    enumerable: false, //不可枚举\r\n    configurable: false, //不可改写\r\n    value,\r\n  });\r\n}\r\n","// 只需要重写会改变原数组的方法,7个,\r\n\r\nlet oldArrayMethods = Array.prototype;\r\n\r\nexport let arrayMethods = Object.create(oldArrayMethods); //原型链  新类 的__proto__ 指向 oldArrayMethods\r\n\r\nconst methods = [\"pop\", \"push\", \"unshift\", \"shift\", \"reverse\", \"sort\", \"splice\"];\r\n\r\nmethods.forEach((method) => {\r\n  arrayMethods[method] = function (...args) {\r\n    // AOP切片编程\r\n    const result = oldArrayMethods[method].apply(this, args);\r\n    // 如果插入的参数,还是一个对象\r\n    let inserted;\r\n    switch (method) {\r\n      case \"push\":\r\n      case \"unshift\":\r\n        inserted = args;\r\n        break;\r\n      case \"splice\": // splice 中间有删除  新增  替换 只需要观测第三个参数\r\n        inserted = args.slice(2);\r\n\r\n      default:\r\n        break;\r\n    }\r\n    let ob = this.__ob__;\r\n    if (inserted) {\r\n      ob.observeArray(inserted);\r\n    }\r\n    return result;\r\n  };\r\n});\r\n","import { isObject, def } from \"../util/index\";\r\nimport { arrayMethods } from \"./array.js\";\r\n\r\nclass Observe {\r\n  constructor(value) {\r\n    // 数据越复杂 层次越深 越费性能,vue2使用递归来给数据定义get 和set\r\n    if (Array.isArray(value)) {\r\n      // 如果是数组的话,并不应去检测数组的索引,浪费性能\r\n      // 但是监控数组的 push pop shift unshift\r\n      value.__ob__ = this; // 方便其他模块调用实例方法\r\n      def(value, \"__ob__\", this);\r\n      value.__proto__ = arrayMethods;\r\n      this.observeArray(value); // 对数组内容拦截\r\n    } else {\r\n      this.walk(value);\r\n    }\r\n  }\r\n  walk(data) {\r\n    let keys = Object.keys(data);\r\n    keys.forEach((key) => {\r\n      defineReactive(data, key, data[key]);\r\n    });\r\n  }\r\n  observeArray(value) {\r\n    for (let i = 0; i < value.length; i++) {\r\n      observe(value[i]);\r\n    }\r\n  }\r\n}\r\nfunction defineReactive(data, key, value) {\r\n  //响应式核心\r\n  observe(value);\r\n  Object.defineProperty(data, key, {\r\n    set(newValue) {\r\n      if (newValue === value) return;\r\n      observe(newValue); // 更换数据后,继续添加监听\r\n      value = newValue;\r\n    },\r\n    get() {\r\n      return value;\r\n    },\r\n  });\r\n}\r\n\r\nexport function observe(data) {\r\n  if (!isObject(data)) {\r\n    return;\r\n  }\r\n  return new Observe(data);\r\n}\r\n","import { observe } from \"./observe/index.js\";\r\nexport function initState(vm) {\r\n  const opts = vm.$options;\r\n  // vue 的数据来源 属性 方法 数据 计算属性 watch\r\n  if (opts.props) {\r\n    initProps(vm);\r\n  }\r\n  if (opts.methods) {\r\n    initMethod(vm);\r\n  }\r\n  if (opts.data) {\r\n    initData(vm);\r\n  }\r\n  if (opts.computed) {\r\n    initComputed(vm);\r\n  }\r\n  if (opts.watch) {\r\n    initWatch(vm);\r\n  }\r\n}\r\nfunction initProps() {}\r\nfunction initMethod() {}\r\nfunction initData(vm) {\r\n  //初始化数据\r\n  let data = vm.$options.data;\r\n  data = typeof data === \"function\" ? data.call(vm) : data;\r\n  vm._data = data;\r\n  //对象劫持 用户改变了数据 我希望可以得到通知 => 刷新页面\r\n  // MVVM 数据变化 驱动 视图变化\r\n  // Object.definedProperty(); 给属性增加 set 和 get 方法\r\n  observe(data); //响应式原理\r\n}\r\nfunction initComputed() {}\r\nfunction initWatch() {}\r\n","import { initState } from \"./state.js\";\r\nexport function initMixin(Vue) {\r\n  //初始化流程\r\n  Vue.prototype._init = function (options) {\r\n    //数据的劫持\r\n    const vm = this; // vue 中使用 this.$options 指代的就是用户传递的属性\r\n    vm.$options = options;\r\n    initState(vm);\r\n  };\r\n}\r\n","// Vue 声明文件\r\nimport { initMixin } from \"./init.js\";\r\nfunction Vue(option) {\r\n  this._init(option);\r\n}\r\ninitMixin(Vue);\r\n\r\nexport default Vue;\r\n"],"names":["isObject","data","def","object","key","value","Object","defineProperty","enumerable","configurable","oldArrayMethods","Array","prototype","arrayMethods","create","methods","forEach","method","args","result","apply","inserted","slice","ob","__ob__","observeArray","Observe","isArray","__proto__","walk","keys","defineReactive","i","length","observe","set","newValue","get","initState","vm","opts","$options","props","initData","computed","watch","call","_data","initMixin","Vue","_init","options","option"],"mappings":"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"}